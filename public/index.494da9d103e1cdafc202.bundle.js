"use strict";(self.webpackChunkcommon_vote=self.webpackChunkcommon_vote||[]).push([[57],{885:()=>{let e=!1;async function t(e){try{console.log(`Loading donations for merchant ${e}...`);const t=await fetch(`/api/v1/comme/ecpay/donations/id=${e}`);!function(e){const t=document.getElementById("donationList"),a=document.getElementById("totalAmount");if(!t||!a)return;let o=0;t.innerHTML="",e.sort(((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)));e.slice(0,5).reverse().forEach((e=>{const a=parseInt(e.cost)||0;o+=a;const c=function(e){return"member"===e.type?"歡迎加入會員！":"gift"===e.type?`贈送 ${e.giftCount||""} 份會員`:"renew"===e.type?`會員 ${e.months||1} 個月`:(e.type,"")}(e),r=function(e,t){return t>=750?"superchat-tier-red":t>=300?"superchat-tier-orange":t>=150?"superchat-tier-yellow":t>=75?"superchat-tier-green":"superchat-tier-blue"}(e.type,a),s=e.message||"",i=document.createElement("div");i.className=`superchat-card ${r}`;const l=document.createElement("div");l.className="superchat-content";const d=document.createElement("div");d.className="superchat-header";const m=document.createElement("span");m.className="superchat-name",m.textContent=e.name||"匿名";const p=document.createElement("span");p.className="superchat-amount",p.textContent=n(a),d.appendChild(m),d.appendChild(p);const u=document.createElement("div");u.className="superchat-title",u.textContent=c;const h=document.createElement("div");h.className="superchat-message",h.textContent=s,l.appendChild(d),l.appendChild(u),l.appendChild(h),i.appendChild(l),t.appendChild(i)})),a.textContent=`總金額: ${n(o)}`}(await t.json())}catch(e){console.error("載入斗內資料失敗:",e)}}function n(e){return new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD"}).format(e)}document.addEventListener("DOMContentLoaded",(async function(){if(e)return void console.log("Already initialized");e=!0,console.log("Initializing app...");const n=new URLSearchParams(window.location.search).get("id");if(n)try{const e=await fetch(`/api/v1/comme/ecpay/check-merchant/id=${n}`),a=await e.json();if(!e.ok||!a.exists)return void(window.location.href=`/ecpay-setting.html?id=${n}`);await t(n);let o=setInterval((()=>t(n)),3e4);window.addEventListener("beforeunload",(()=>{o&&clearInterval(o)}))}catch(e){console.error("初始化失敗:",e)}else window.location.href="/login.html"}),{once:!0})}},e=>{e(e.s=885)}]);
//# sourceMappingURL=index.494da9d103e1cdafc202.bundle.js.map